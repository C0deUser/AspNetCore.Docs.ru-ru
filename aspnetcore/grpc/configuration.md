---
title: Конфигурация gRPC для .NET
author: jamesnk
description: Узнайте, как настроить gRPC для приложений .NET.
monikerRange: '>= aspnetcore-3.0'
ms.author: jamesnk
ms.custom: mvc
ms.date: 02/26/2020
uid: grpc/configuration
ms.openlocfilehash: 4c13c45ce745643c3cb089a1c984d2ef599db48b
ms.sourcegitcommit: 6c8cff2d6753415c4f5d2ffda88159a7f6f7431a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81440835"
---
# <a name="grpc-for-net-configuration"></a>Конфигурация gRPC для .NET

## <a name="configure-services-options"></a>Параметры настройки служб

Службы gRPC настраиваются с `AddGrpc` в *Startup.cs*. В следующей таблице описаны параметры настройки служб gRPC.

| Параметр | Значение по умолчанию | Описание |
| ------ | ------------- | ----------- |
| MaxSendMessageSize | `null` | Максимальный размер сообщения в байтах, которое может быть отправлено с сервера. Попытка отправить сообщение, превышающее заданный максимальный размер сообщения, приведет к исключению. Если задано значение `null`, то размер сообщения не ограничен. |
| MaxReceiveMessageSize | 4 МБ | Максимальный размер сообщения в байтах, которое может быть получено сервером. Если сервер получает сообщение, размер которого превышает это ограничение, вызывается исключение. Увеличение этого значения позволяет серверу принимать сообщения большего размера, однако это может негативно сказаться на потреблении памяти. Если задано значение `null`, то размер сообщения не ограничен. |
| EnableDetailedErrors | `false` | Если параметру присвоено значение `true`, при возникновении исключения в методе службы клиентам возвращаются подробные сообщения об исключениях. Значение по умолчанию — `false`. Установка для параметра `EnableDetailedErrors` значения `true` может привести к утечке конфиденциальной информации. |
| CompressionProviders | gzip | Коллекция поставщиков сжатия, используемая для сжатия и распаковки сообщений. Можно создать настраиваемые поставщики сжатия и добавить их в коллекцию. Настроенные по умолчанию поставщики поддерживают сжатие **gzip**. |
| <span style="word-break:normal;word-wrap:normal">ResponseCompressionAlgorithm</span> | `null` | Алгоритм сжатия, используемый для сжатия сообщений, отправляемых с сервера. Алгоритм должен соответствовать поставщику сжатия в `CompressionProviders`. Чтобы алгоритм выполнял сжатие ответа, клиент должен указать, что он поддерживает алгоритм, отправив его в заголовке **grpc-accept-encoding**. |
| ResponseCompressionLevel | `null` | Уровень сжатия, используемый для сжатия сообщений, отправляемых с сервера. |
| Перехватчики | Отсутствуют | Коллекция перехватчиков, которые выполняются с каждым вызовом gRPC. Перехватчики выполняются в том порядке, в котором они зарегистрированы. Глобально настроенные перехватчики выполняются до того, как будут выполнены перехватчики, настроенные для одной службы. Дополнительные сведения о перехватчиках gRPC см. в разделе [перехватчики gRPC и ПО промежуточного слоя](xref:grpc/migration#grpc-interceptors-vs-middleware). |

Параметры можно настроить для всех служб, предоставив делегаты параметров для вызова `AddGrpc` в `Startup.ConfigureServices`:

[!code-csharp[](~/grpc/configuration/sample/GrcpService/Startup.cs?name=snippet)]

Параметры одной службы переопределяют глобальные параметры, предоставленные в `AddGrpc`, и могут быть настроены с помощью `AddServiceOptions<TService>`:

[!code-csharp[](~/grpc/configuration/sample/GrcpService/Startup2.cs?name=snippet)]

## <a name="configure-client-options"></a>Настройка параметров клиента

Конфигурация клиента gRPC задается в `GrpcChannelOptions`. В следующей таблице описаны параметры настройки каналов gRPC.

| Параметр | Значение по умолчанию | Описание |
| ------ | ------------- | ----------- |
| HttpClient | Новый экземпляр | `HttpClient`, используемый для выполнения вызовов gRPC. Клиент может быть настроен для настройки пользовательского `HttpClientHandler` или добавления дополнительных обработчиков в конвейер HTTP для вызовов gRPC. Если `HttpClient` не указан, то для канала создается новый экземпляр `HttpClient`. Он будет автоматически удален. |
| DisposeHttpClient | `false` | Если указано значение `true` и задан `HttpClient`, то экземпляр `HttpClient` будет удален при удалении `GrpcChannel`. |
| LoggerFactory | `null` | `LoggerFactory`, используемый клиентом для записи в журнал сведений о вызовах gRPC. Экземпляр `LoggerFactory` можно разрешить из внедрения зависимостей или создать с помощью `LoggerFactory.Create`. Примеры настройки ведения журнала см. в разделе <xref:grpc/diagnostics#grpc-client-logging>. |
| MaxSendMessageSize | `null` | Максимальный размер сообщения в байтах, которое может быть отправлено из клиента. Попытка отправить сообщение, превышающее заданный максимальный размер сообщения, приведет к исключению. Если задано значение `null`, то размер сообщения не ограничен. |
| <span style="word-break:normal;word-wrap:normal">MaxReceiveMessageSize</span> | 4 МБ | Максимальный размер сообщения в байтах, которое может быть получено клиентом. Если клиент получает сообщение, размер которого превышает это ограничение, вызывается исключение. Увеличение этого значения позволяет клиенту принимать сообщения большего размера, однако это может негативно сказаться на потреблении памяти. Если задано значение `null`, то размер сообщения не ограничен. |
| Учетные данные | `null` | Экземпляр `ChannelCredentials`. Учетные данные используются для добавления метаданных проверки подлинности в вызовы gRPC. |
| CompressionProviders | gzip | Коллекция поставщиков сжатия, используемая для сжатия и распаковки сообщений. Можно создать настраиваемые поставщики сжатия и добавить их в коллекцию. Настроенные по умолчанию поставщики поддерживают сжатие **gzip**. |

В приведенном ниже коде

* Задается максимальный размер сообщения для отправки и получения в канале.
* Создается клиент.

[!code-csharp[](~/grpc/configuration/sample/Program.cs?name=snippet&highlight=3-8)]

[!INCLUDE[](~/includes/gRPCazure.md)]

## <a name="additional-resources"></a>Дополнительные ресурсы

* <xref:grpc/aspnetcore>
* <xref:grpc/client>
* <xref:grpc/diagnostics>
* <xref:tutorials/grpc/grpc-start>
