---
title: Миграция с ASP.NET MVC на ASP.NET Core MVC
author: ardalis
description: Узнайте, как приступить к переносу проекта ASP.NET MVC для ASP.NET Core MVC.
ms.author: riande
ms.date: 04/06/2019
no-loc:
- Blazor
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: migration/mvc
ms.openlocfilehash: 59a10c002958e5f719dbd59686f21df69da5f43e
ms.sourcegitcommit: 70e5f982c218db82aa54aa8b8d96b377cfc7283f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2020
ms.locfileid: "82777050"
---
# <a name="migrate-from-aspnet-mvc-to-aspnet-core-mvc"></a>Миграция с ASP.NET MVC на ASP.NET Core MVC

[Рик Андерсон (](https://twitter.com/RickAndMSFT), [Даниэль Roth)](https://github.com/danroth27), [Стив Смит](https://ardalis.com/)и [Скотт Эдди (](https://scottaddie.com)

В этой статье показано, как приступить к переносу проекта ASP.NET MVC для [ASP.NET Core MVC](../mvc/overview.md). В процессе он выделяет многие вещи, которые изменились с ASP.NET MVC. Миграция с ASP.NET MVC — это несколько этапов, и в этой статье рассматривается начальная настройка, базовые контроллеры и представления, статическое содержимое и зависимости на стороне клиента. Дополнительные статьи охватывают перенос конфигурации и кода идентификации во многих проектах ASP.NET MVC.

> [!NOTE]
> Номера версий в примерах могут быть неактуальными. Может потребоваться соответствующим образом обновить проекты.

## <a name="create-the-starter-aspnet-mvc-project"></a>Создание проекта MVC для начального ASP.NET

Чтобы продемонстрировать обновление, мы начнем с создания приложения ASP.NET MVC. Создайте его с именем "имя *APP1* ", чтобы пространство имен совпадало с ASP.NET Core проектом, созданным на следующем шаге.

![Диалоговое окно «Создание проекта» Visual Studio](mvc/_static/new-project.png)

![Диалоговое окно "новое веб-приложение": шаблон проекта MVC, выбранный на панели шаблоны ASP.NET](mvc/_static/new-project-select-mvc-template.png)

*Необязательно:* Измените имя решения с *Mvc5* *на.* Visual Studio отображает новое имя решения (*Mvc5*), которое упрощает указание этого проекта из следующего проекта.

## <a name="create-the-aspnet-core-project"></a>Создание проекта ASP.NET Core

Создайте *пустое* веб-приложение ASP.NET Core с тем же именем, что и у предыдущего проекта (веб-приложения*APP1*), чтобы пространства имен в двух проектах совпадали. Наличие одного и того же пространства имен упрощает копирование кода между двумя проектами. Вам потребуется создать этот проект в каталоге, отличном от каталога предыдущего проекта, для использования того же имени.

![Диалоговое окно "Новый проект"](mvc/_static/new_core.png)

![Диалоговое окно "Создание веб-приложения ASP.NET": пустой шаблон проекта, выбранный на панели "шаблоны ASP.NET Core"](mvc/_static/new-project-select-empty-aspnet5-template.png)

* *Необязательно:* Создайте новое приложение ASP.NET Core с помощью шаблона проекта *веб-приложения* . Назовите проект *"* имя_проекта" и выберите параметр проверки подлинности для **отдельных учетных записей пользователей**. Переименуйте это приложение в *фулласпнеткоре*. Создание этого проекта экономит время при преобразовании. Чтобы увидеть конечный результат или скопировать код в проект преобразования, можно взглянуть на созданный шаблоном код. Это также полезно, если вы захотите выполнить шаг преобразования для сравнения с проектом, созданным с помощью шаблона.

## <a name="configure-the-site-to-use-mvc"></a>Настройка сайта для использования MVC

::: moniker range=">= aspnetcore-2.1"

* При разработке для .NET Core ссылка на [Microsoft. AspNetCore. app метапакет](xref:fundamentals/metapackage-app) используется по умолчанию. Этот пакет содержит пакеты, часто используемые приложениями MVC. Если целевой объект .NET Framework, ссылки на пакеты должны быть перечислены по отдельности в файле проекта.

::: moniker-end

::: moniker range="= aspnetcore-2.0"

* При разработке для .NET Core ссылка на [Microsoft. AspNetCore. ALL метапакет](xref:fundamentals/metapackage) используется по умолчанию. Этот пакет содержит пакеты, часто используемые пакетами приложений MVC. Если целевой объект .NET Framework, ссылки на пакеты должны быть перечислены по отдельности в файле проекта.

::: moniker-end

::: moniker range="< aspnetcore-2.0"

* При нацеливании на .NET Core или .NET Framework пакеты, обычно используемые приложениями MVC, перечисляются по отдельности в файле проекта.

::: moniker-end

`Microsoft.AspNetCore.Mvc`является ASP.NET Core платформой MVC. `Microsoft.AspNetCore.StaticFiles`является обработчиком статических файлов. Среда выполнения ASP.NET Core является модульной, и необходимо явно включить для обслуживания статических файлов (см. раздел [статические файлы](xref:fundamentals/static-files)).

* Откройте файл *Startup.CS* и измените код в соответствии со следующим кодом:

  [!code-csharp[](mvc/sample/Startup.cs?highlight=13,26-31)]

Метод `UseStaticFiles` расширения добавляет обработчик статических файлов. Как упоминалось ранее, среда выполнения ASP.NET является модульной, и необходимо явно использовать для обслуживания статических файлов. Метод `UseMvc` расширения добавляет маршрутизацию. Дополнительные сведения см. в разделе Запуск и [Маршрутизация](xref:fundamentals/routing) [приложений](xref:fundamentals/startup) .

## <a name="add-a-controller-and-view"></a>Добавление контроллера и представления

В этом разделе вы добавите минимальный контроллер и представление, которые будут использоваться в качестве заполнителей для контроллера MVC ASP.NET и представлений, которые вы будете переносить в следующем разделе.

* Добавьте папку *Controllers* .

* Добавьте **класс контроллера** с именем *HomeController.CS* в папку *Controllers* .

![Диалоговое окно ''Добавление нового элемента''](mvc/_static/add_mvc_ctl.png)

* Добавьте папку *views* .

* Добавьте папки *Views/Home* .

* Добавьте ** Razor представление** с именем *index. cshtml* в папку *Views/Home* .

![Диалоговое окно ''Добавление нового элемента''](mvc/_static/view.png)

Структура проекта показана ниже:

![обозреватель решений отображения файлов и папок в файле App1](mvc/_static/project-structure-controller-view.png)

Замените содержимое файла *Views/Home/Index. cshtml* следующим:

```html
<h1>Hello world!</h1>
```

Запустите приложение.

![Веб-приложение открыто в Microsoft ребро](mvc/_static/hello-world.png)

Дополнительные сведения см. в разделе [Controllers](xref:mvc/controllers/actions) and [views](xref:mvc/views/overview) .

Теперь, когда у нас есть проект с минимальными рабочими ASP.NET Core, мы можем начать миграцию функций из проекта ASP.NET MVC. Необходимо переместить следующее:

* содержимое на стороне клиента (CSS, шрифты и скрипты)

* controllers

* узел "Представления"

* модели

* объединения

* filters

* Вход в систему Identity (это делается в следующем руководстве).

## <a name="controllers-and-views"></a>Контроллеры и представления

* Скопируйте каждый из методов из MVC `HomeController` ASP.NET в новый. `HomeController` Обратите внимание, что в ASP.NET MVC тип возвращаемого значения метода действия контроллера встроенного шаблона — [ActionResult](https://msdn.microsoft.com/library/system.web.mvc.actionresult(v=vs.118).aspx); в ASP.NET Core MVC вместо этого возвращаются `IActionResult` методы действия. `ActionResult`реализует `IActionResult`, поэтому нет необходимости изменять тип возвращаемого значения методов действия.

* Скопируйте файлы представления *About. cshtml*, *Contact. cshtml*и *index. cshtml* Razor из проекта MVC ASP.NET в проект ASP.NET Core.

* Запустите приложение ASP.NET Core и протестируйте каждый метод. Мы еще не выполнили миграцию файла макета или стилей, поэтому отображаемые представления содержат только содержимое в файлах представления. В файле макета не будут созданы ссылки для представлений `About` и `Contact` , поэтому их придется вызывать из браузера (замените **4492** на номер порта, используемый в проекте).

  * `http://localhost:4492/home/about`

  * `http://localhost:4492/home/contact`

![Страница контактов](mvc/_static/contact-page.png)

Обратите внимание на отсутствие стилей и пунктов меню. Мы исправим это в следующем разделе.

## <a name="static-content"></a>Статическое содержимое

В предыдущих версиях ASP.NET MVC статическое содержимое было размещено из корневого каталога веб-проекта и было смешано с файлами на стороне сервера. В ASP.NET Core статическое содержимое размещается в папке *wwwroot* . Вам потребуется скопировать статическое содержимое из старого приложения ASP.NET MVC в папку *wwwroot* в проекте ASP.NET Core. В этом примере преобразования:

* Скопируйте файл *фавикон. ico* из старого проекта MVC в папку *wwwroot* в проекте ASP.NET Core.

Старый проект ASP.NET MVC использует для своей стилизации [начальную загрузку](https://getbootstrap.com/) и сохраняет файлы начальной загрузки в папках *Content* и *Scripts* . Шаблон, создавший старый проект MVC ASP.NET, ссылается на загрузку в файле макета (*views/Shared/_layout. cshtml*). Можно скопировать файлы *начальной загрузки. js* и *начальной загрузки css* из проекта ASP.NET MVC в папку *wwwroot* в новом проекте. Вместо этого мы добавим поддержку начальной загрузки (и других клиентских библиотек) с помощью CDN в следующем разделе.

## <a name="migrate-the-layout-file"></a>Перенос файла макета

* Скопируйте файл *_ViewStart. cshtml* из папки *views* старого проекта ASP.NET MVC в папку *views* проекта ASP.NET Core. Файл *_ViewStart. cshtml* не был изменен в ASP.NET Core MVC.

* Создайте папку *views/Shared* .

* *Необязательно:* Скопируйте *_ViewImports. cshtml* из папки *views* проекта *фулласпнеткоре* MVC в папку *представления* проекта ASP.NET Core. Удалите любое объявление пространства имен в файле *_ViewImports. cshtml* . Файл *_ViewImports. cshtml* предоставляет пространства имен для всех файлов представлений и переводит их в [вспомогательные функции тегов](xref:mvc/views/tag-helpers/intro). Вспомогательные функции тегов используются в новом файле макета. Файл *_ViewImports. cshtml* является новым для ASP.NET Core.

* Скопируйте файл *_layout. cshtml* из старого *представления или общей* папки проекта MVC ASP.NET в папку *views/Shared (представления* ) проекта ASP.NET Core.

Откройте файл *_layout. cshtml* и внесите следующие изменения (завершенный код показан ниже):

* Замените `@Styles.Render("~/Content/css")` на `<link>` элемент для загрузки *начальной загрузки. CSS* (см. ниже).

* Удалите `@Scripts.Render("~/bundles/modernizr")`.

* Закомментируйте `@Html.Partial("_LoginPartial")` строку (заключите строку в `@*...*@`). Дополнительные сведения см. [в статье миграция проверки подлинности и Identity для ASP.NET Core](xref:migration/identity)

* Замените `@Scripts.Render("~/bundles/jquery")` на `<script>` элемент (см. ниже).

* Замените `@Scripts.Render("~/bundles/bootstrap")` на `<script>` элемент (см. ниже).

Заменяющая разметка для включения начальной загрузки CSS:

```html
<link rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
    crossorigin="anonymous">
```

Заменяющая разметка для jQuery и начальная загрузка JavaScript:

```html
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
```

Обновленный файл *_layout. cshtml* показан ниже:

[!code-cshtml[](mvc/sample/Views/Shared/_Layout.cshtml?highlight=7-10,29,41-44)]

Просмотр сайта в браузере. Теперь она должна быть правильно загружена с ожидаемыми стилями.

* *Необязательно:* Может потребоваться использовать новый файл макета. Для этого проекта можно скопировать файл макета из проекта *фулласпнеткоре* . Новый файл макета использует [вспомогательные функции тегов](xref:mvc/views/tag-helpers/intro) и содержит другие улучшения.

## <a name="configure-bundling-and-minification"></a>Настройка объединения и минификации

Сведения о настройке объединения и минификации см. в разделе [объединение и минификации](../client-side/bundling-and-minification.md).

## <a name="solve-http-500-errors"></a>Устранение ошибок HTTP 500

Существует множество проблем, которые могут вызвать сообщение об ошибке HTTP 500, которое не содержит информации об источнике проблемы. Например, если файл *views/_ViewImports. cshtml* содержит пространство имен, которое не существует в проекте, вы получите ошибку HTTP 500. По умолчанию в ASP.NET Core приложениях `UseDeveloperExceptionPage` расширение добавляется в `IApplicationBuilder` и выполняется при *разработке*конфигурации. Это подробно описано в следующем коде:

[!code-csharp[](mvc/sample/Startup.cs?highlight=19-22)]

ASP.NET Core преобразует необработанные исключения в веб-приложении в ответные сообщения об ошибках HTTP 500. Как правило, сведения об ошибке не включаются в эти ответы, чтобы предотвратить раскрытие потенциально конфиденциальной информации о сервере. Дополнительные сведения см. в статье об **использовании страницы "исключение разработчика"** в разделе " [ошибки обработчика](../fundamentals/error-handling.md) ".

## <a name="additional-resources"></a>Дополнительные ресурсы

* <xref:blazor/index>
* <xref:mvc/views/tag-helpers/intro>
